
<html lang='EN'>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>HCS</title>
<link rel="shortcut icon" href="./images/favicon.ico">
<link type="text/css" rel="stylesheet" href="./css/normalize.min.css">
<link type="text/css" rel="stylesheet" href="./css/reset.css">
<!--link type="text/css" rel="stylesheet" href="./css/fonts.css"-->
<link type="text/css" rel="stylesheet" href="./css/ionicons.min.css">
<link type="text/css" rel="stylesheet" href="./css/style.css">

<script type="text/javascript" src="./js/jquery/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="./js/jquery/jquery-ui.min.js"></script>
<script type="text/javascript" src="./js/function.debug.js"></script>
<script type="text/javascript" src="./js/common.js"></script>
<script type="text/javascript" src="./js/script.js"></script>


<script type="text/javascript">
    var grid = "";
    var grid2 = "";
    var gridRowIdx;
    
    // 전역변수 >> Toast Grid 셀 번호 처리
    this.url = "";

    $(document).ready(function() {
        $("#sgrpCd").on("change paste", function(){
            var rowKey =  $("#rowKey").val();
            setCRUDFlag(grid,rowKey,"U",true);
            grid.setValue(rowKey, 'sgrpCd', sgrpCd.value);
            //grid2 sgrpCd셋팅
            for(var i=0;i<grid2.getRows().length;i++){
                grid2.setValue(i,"sgrpCd",sgrpCd.value);
            }
        });
        $("#cdExpl").on("change paste", function(){
            var rowKey =  $("#rowKey").val();
            setCRUDFlag(grid,rowKey,"U",true);
            grid.setValue(rowKey, 'cdExpl', cdExpl.value);
        });
        $("#optCd1").on("change paste", function(){
            var rowKey =  $("#rowKey").val();
            setCRUDFlag(grid,rowKey,"U",true);
            grid.setValue(rowKey, 'optCd1', optCd1.value);
        });
        $("#optCd2").on("change paste", function(){
            var rowKey =  $("#rowKey").val();
            setCRUDFlag(grid,rowKey,"U",true);
            grid.setValue(rowKey, 'optCd2', optCd2.value);
        });
        $("#optCd3").on("change paste", function(){
            var rowKey =  $("#rowKey").val();
            setCRUDFlag(grid,rowKey,"U",true);
            grid.setValue(rowKey, 'optCd3', optCd3.value);
        });
        $("#optCd4").on("change paste", function(){
            var rowKey =  $("#rowKey").val();
            setCRUDFlag(grid,rowKey,"U",true);
            grid.setValue(rowKey, 'optCd4', optCd4.value);
        });
        $("#rem").on("change paste", function(){
            var rowKey =  $("#rowKey").val();
            
            setCRUDFlag(grid,rowKey,"U",true);
            grid.setValue(rowKey, 'rem', rem.value);
        });
        
        $("#rem").bind('keyup', function(){
		      if(gfnGetLengB($("#rem").val())>399){
            var sValue = $("#rem").val();
            var v_ChkStr = sValue.toString();
            var v_cnt = 0;
            var strRem="";
            for (var i = 0; i < v_ChkStr.length; i++) {
                if (v_ChkStr.charCodeAt(i) > 127) {
                    v_cnt += 3;
                } else {
                    v_cnt += 1;
                }
                if(v_cnt>399){
                  break;
                }else{

                  strRem = strRem+v_ChkStr.substr(i,1);
                }
            }
            $("#rem").val(strRem);
          }
      	});

        $("#useYn").on("change paste", function(){
            var rowKey =  $("#rowKey").val();
            setCRUDFlag(grid,rowKey,"U",true);
            if(useYn.checked){
                grid.setValue(rowKey, 'useYn', 'Y');
            }else{
                grid.setValue(rowKey, 'useYn', 'N');
            }
        });

        $("#sortNo").bind('change keyup', function(){
		      gfnChkNumOnly(this);
		      var rowKey =  $("#rowKey").val();
		      setCRUDFlag(grid,rowKey,"U",true);
		      grid.setValue(rowKey, 'sortNo', sortNo.value);
      	});

        $('#btnSearch').click(function() {
                fnSelectList();
        });
        $("select[name='schCdType']").on('change',function() {
            fnChangSchCdType();
        });

        $("#grid3").dblclick(function(ev){
          var rowKey = grid3.getFocusedCell().rowKey;
          if(gfnIsNull(rowKey)){
            return;
          }
          fnSet();
        });

        //검색input  Enter 조회
        $("#searchForm").keyup(function(event){
            if(event.keyCode == 13){
                fnSelectList();
            }
        });

        //팝업창
        $("#commonCodeList").hide();
        
        $(function() {
            $('#modal-content').draggable();
        });
        
        var modal5 = $('#commonCodeList');
        $('.btn-search').on('click', function() {
            modal5.fadeIn();
        });
        $('.close').on('click', function() {
        modal5.fadeOut();
        });
        $('.cancel').on('click', function() {
        modal5.fadeOut();
        });

        $('#excelDownBtn').on('click', function(ev){
          if(grid.getRows().length == 0) {
              gfnAlert(300, "${msg.m00028}");
              return;
          } else {
              if (typeof excelModal != 'undefined') {
                  excelModal.style.display = "block";
              }
          }
      });

      $('#excelUp').on('click', function(ev) {
          $('#btnUpload').val('');
          $('#btnUpload').click();
      });

        var listItems = [
                         <c:forEach var="record" items="${showroomList}" varStatus="status">
                         { text: '${record.name}', value: '${record.code}' },
                         </c:forEach>
                         ];
    
        var rowHeaders = [
                  {
                      type: 'rowNum',
                      title: "<div id='treeHeadPlus'  style='cursor:pointer;'>-</div>",
                      width:40
                  }
                          ];
    
          // column define for grid
        var  columns = [
                              {
                              title: "",
                              name: 'no',
                              width:40,
                              align:'center',
                              hidden:true
                              },
                            {title:'status', name: 'status', hidden:true},
                            {title:'cdExpl', name: 'cdExpl', hidden:true},
                            {title:'lgrpCd', name: 'lgrpCd', hidden:true},
                            {title: '',name: 'userSet',width:40,align:'left'},
                            {
                            title: '${msg.l00023}',
                            hit: '분류명',
                            align:'left',
                            name: 'cdExplNm',
                                onAfterChange: function(ev){
                                    if(grid.getValue(ev.rowKey, 'status') != 'I') {
                                          grid.setValue(ev.rowKey, 'status', 'U');
                                        }
                                }
                                
                            },
                            {
                            title: '${msg.l00128}',
                            hit: '공통코드',
                            name: 'sgrpCd',
                            align:'center',
                                onAfterChange: function(ev){
                                    if(grid.getValue(ev.rowKey, 'status') != 'I') {
                                          grid.setValue(ev.rowKey, 'status', 'U');
                                        }
                                }
                                
                            }
                         ];
               
          var option = {gridid:"grid", columns:columns, rowHeaders:rowHeaders, scrollX:false, scrollY:true,maxBodyHeight:500, bodyHeight:600,treeColumnOptions: {name: 'cdExplNm',useCascadingCheckbox: true}};
          grid = createGridUi(option);
          
            
          grid.on('click', function(ev){
            console.log(ev);
              if(ev.targetType=="columnHead"){
                if(ev.columnName=="no"||ev.columnName=="_number"){
                  fnButtons("tree");
                }
                return;
              }

              var rowKey = ev.rowKey;
              var columnName = ev.columnName;
              
              if(columnName == null || rowKey < 0){
                console.log("columnName:"+columnName);
                console.log("rowKey:"+rowKey);
                    return;
              }

              gridRowIdx = rowKey;
              fnGetDetailInfo(rowKey);
              
          });
          var rowHeaders2 = [
                    {type: 'rowNum', title: '${msg.l00011}'}
                      ];   
          var columns2 = [
                            {title:'${msg.l00021}', hit:'언어 l00021',   name: 'langNm', align:'center'},
                            {title:'${msg.l00074}', hit:'코드명 l00074', name: 'cdNm', align:'left',
                                onAfterChange: function(ev){
                                    setCRUDFlag(grid2,ev.rowKey,"U",true);
                                    setCRUDFlag(grid,$("#rowKey").val(),"U",false);
                                    $("#cdNm ").val(ev.value);
                                    grid.setValue($("#rowKey").val(), "grid2", grid2.getRows());
                                },
                                editOptions: {
                                    type: 'text',
                                    maxLength: 250,
                                    useViewMode: false }
                                },
                            {title:'${msg.l00072}', hit:'비고', name: 'rem',
                                onAfterChange: function(ev){
                                    setCRUDFlag(grid2,ev.rowKey,"U",true);
                                    setCRUDFlag(grid,$("#rowKey").val(),"U",false);
                                    grid.setValue($("#rowKey").val(), "grid2", grid2.getRows());
                                },
                                editOptions: {
                                    type: 'text',
                                    maxLength: 200,
                                    useViewMode: false }},
                            {title:'', hidden:true, name: 'dlrCd'},
                            {title:'', hidden:true, name: 'srCd'},
                            {title:'', hidden:true, name: 'msgCd'},
                            {title:'', hidden:true, name: 'status'}
                          ];
        
        var option={gridid:"grid2", columns:columns2, rowHeaders:rowHeaders2, scrollX:false, scrollY:false};
        grid2 = createGridUi(option);
        //그리드 셀 클릭시
        grid2.on('click', function(ev){
            var rowKey = ev.rowKey;
            var columnName = ev.columnName;

            if(columnName == null || rowKey == null){
                    return;
            }
            
            $("#rowKey2").val(rowKey);
        });

        fnChangSchCdType();
        fnSelectList();
        $("div.tui-grid-layer-focus").remove();


        
      });
    

    /////////////////////////////////////////////////////////
    //목록조회
    /////////////////////////////////////////////////////////
    function fnSelectList(){
        //전역 변수 초기화
        gridRowIdx=-1;

        $("#rowKey").val('');
        $("#rowKey2").val('');

        //폼초기화
        $("#sgrpCd").val('');
        sgrpCd.disabled = true;
        $("#lgrpCd").val('');
        lgrpCd.disabled = true;
        $("#cdExpl").val('');
        cdExpl.disabled = true;
        $("#rem").val('');
        rem.disabled = true;
        $("#optCd1").val('');
        optCd1.disabled = true;
        $("#optCd2").val('');
        optCd2.disabled = true;
        $("#optCd3").val('');
        optCd3.disabled = true;
        $("#optCd4").val('');
        optCd4.disabled = true;
        $("#sortNo").val('');
        sortNo.disabled = true;
        //그리드초기화
        grid.clear();
        grid2.clear();
        
        //팝업버튼
        btnPopSearch.disabled = true;

        var data = {
          cdType : $('#schCdType').val(),
          dlrSrCd :$('#schDlrSrCd').val(),
          lgrpCd : $('#schLgrpCd').val(),
          cdExpl : $('#schCdExpl').val(),
          sgrpCd : $('#schSgrpCd').val(),
          cdExplNm : $('#schCdExplNm').val(),
          sUseYn:  $('#schUseYn').val()
        };
        //조회
        var url = "/system/commonCode/selectListAjax.do";
        gfnAjax(url, data, selectListCallback);
    }
    
     /////////////////////////////////////////////////////////
    //상세조회
    /////////////////////////////////////////////////////////
    function fnGetDetailInfo(idx){
        var row = grid.getRow(idx);
        
        $("#rowKey").val(row.rowKey);
        $("#rowKey2").val('');

        if(row.commonCode=="0000"){
          $("#lgrpCd").val(row.commonCode);
          $("#sgrpCd").val(row.lgrpCd);
        }else{
          $("#lgrpCd").val(row.lgrpCd);
          $("#sgrpCd").val(row.sgrpCd);
        }
       
        gridRowIdx = row;
        
        if(row.status == "I"){
          btnPopSearch.disabled = false;
          sgrpCd.disabled = false;
        }else{
          lgrpCd.disabled = true;
          btnPopSearch.disabled = true;
          sgrpCd.disabled = true;
        }
        $("#cdExpl").val(row.cdExpl);
        cdExpl.disabled = false;
        $("#rem").val(row.rem);
        rem.disabled = false;
        $("#optCd1").val(row.optCd1);
        optCd1.disabled = false;
        $("#optCd2").val(row.optCd2);
        optCd2.disabled = false;
        $("#optCd3").val(row.optCd3);
        optCd3.disabled = false;
        $("#optCd4").val(row.optCd4);
        optCd4.disabled = false;
        $("#sortNo").val(row.sortNo);
        sortNo.disabled = false;

        //그리드2초기화
        grid2.clear();
        
        if(row.useYn=='Y'){
            useYn.checked = true;
        }else{
            useYn.checked = false;
        }
    
        //대분류이면 조회 하지 않는다.
        if(row.commonCode=="0000"){
          return;
        }
        //grid2데이타 유무로 조회 또는 이전데이타 보여줌
        if(gfnIsNull(grid.getValue(row.rowKey, 'grid2'))){
            var data = {
                        lgrpCd : row.lgrpCd,
                        sgrpCd : row.sgrpCd,
                        dlrSrCd : row.dlrSrCd,
                        cdType : row.cdType,
                        sUseYn :  $('#schUseYn').val()
            };
            gridRowIdx = row;
           
            //조회
            var type = "POST";
            var url = "/system/commonCodeLangList/selectListAjax.do";
            gfnAjax(url, data, selectListCallback2);
            
        } else {
            grid2.clear();
            grid2.setData(grid.getValue(row.rowKey, 'grid2'));
        }
    }
    
    /////////////////////////////////////////////////////////
    //팝업목록조회
    /////////////////////////////////////////////////////////
    function fnSelectListPop22(){
      var url = "/system/commonCodeLgrp/selectListAjax.do";
      
        //그리드초기화
        grid3.clear();
        
        var data = {
          cdType : $('#schCdType').val(),
          lgrpCd : $('#schLgrpCd').val(),
          cdExpl : $('#schCdExpl').val()
        };
        
        //조회
        gfnAjax(url, data, selectListCallback3);
    }

    /////////////////////////////////////////////////////////
    //공통유형변경
    /////////////////////////////////////////////////////////
    function fnChangSchCdType(){
      var url = "/common/commonCode/selectCodeListAjax.do";
      //쇼룸 0057 딜러1000

      var lgrpCd;
      if($('#schCdType').val()=="0001"){
        lgrpCd = "9999";
      }else if($('#schCdType').val()=="0002"){
        lgrpCd = "0057";
      }else if($('#schCdType').val()=="0003"){
        lgrpCd = "1000";
      }
      var data = {srCd : "", lgrpCd : lgrpCd, dlrSrCd : "XXXX", cdType : '0001'};
      
      //조회
      gfnAjax(url, data, changSchCdTypeCallback);
    }


    function changSchCdTypeCallback(data) {
        var objSel = document.getElementById("schDlrSrCd");
        objSel.options.length = 0;
        for(var i=0; i<data.commonCodeList.length; i++) {
            // select 태그의 option을 정의한다.
            gfnAddOption(objSel, "["+data.commonCodeList[i].code+"] "+data.commonCodeList[i].name, data.commonCodeList[i].code);
        }
    }
  
    /////////////////////////////////////////////////////////
    //공통 버튼 처리
    /////////////////////////////////////////////////////////
    function fnButtons(param){
        switch(param){
            case "new" :
                
                var  rowCount = grid.getRowCount() + 1;
                
        
                grid.appendRow({no:rowCount},{pcount:28});
                
                //scroll
                var contentHeight = $(".tui-grid-body-container").height();
                $(".tui-grid-body-area").animate({
                   scrollTop : contentHeight
                }, 500);
                
                var list = grid.findRows({no:rowCount});
                var nRow = list[0].rowKey;

                //focus
                //grid.setValue(rowKey, 'lgrpCd', lgrpCd.value);
                grid.focus(nRow, 'cdExplNm', false);
                grid.setValue(nRow, 'dlrSrCd', $('#schDlrSrCd').val());
                grid.setValue(nRow, 'cdType', $('#schCdType').val());
                grid.setValue(nRow, 'status', 'I');
                grid.setValue(nRow, 'useYn', 'Y');
              
                setCRUDFlag(grid,nRow,"I", false);

                //코드목록에선택된 대분류코드로 셋팅
                if(!gfnIsNull($('#rowKey').val())){
                  if($('#lgrpCd').val()=="0000"){
                    grid.setValue(nRow, 'lgrpCd', $('#sgrpCd').val());
                  }else{
                    grid.setValue(nRow, 'lgrpCd', $('#lgrpCd').val());
                  }
                   
                }
                $('#rowKey').val(nRow);
                fnGetDetailInfo(nRow);
                grid3.refreshLayout(); 
                break;
                
            case "save" :
                this.url = '/system/commonCode/saveAjax.do';
                var list = getGridList(grid);
                var list2 = getGridList2(grid);
                if(list.length==0 && list2.length==0) {
                    gfnAlert("", "${msg.m00036}");
                    return false;
                }
                for(var i=0; i<list.length; i++){
                  if(list[i].lgrpCd==""||list[i].lgrpCd==null){
                    gfnAlert("",gfnGetMsg("${msg.m00007}",'${msg.l00235}'));   //대분류 입력해 주세요.
                    return;
                  }
                  if(list[i].sgrpCd==""||list[i].sgrpCd==null){
                    gfnAlert("",gfnGetMsg("${msg.m00007}",'${msg.l00237}'));   //소분류입력해 주세요.
                    return;
                  }    
                }
                console.log(list);
                console.log(list2);

                gfnConfirm('${msg.m00031}', function(confirm) { //저장하시겠습니까?
                    if (confirm) {
                      var data = {"list" : JSON.stringify(list), "list2" : JSON.stringify(list2)};
                      gfnAjax( this.url, data, fnAjaxHandler);
                    }
                }); 



                break;
                
            case "delete" :
                this.url = '';
                var rowKey = $("#rowKey").val();
    
                if(grid.getValue(rowKey, 'status', false) == "I"){
                    grid.removeRow(rowKey);
                    
                    //초기화로직(신규추가된게없을때사용)
                    grid2.clear();
                    $("#rowKey").val('');
                    $("#rowKey2").val('');

                    //폼초기화
                    $("#sgrpCd").val('');
                    sgrpCd.disabled = true;
                    $("#lgrpCd").val('');
                    lgrpCd.disabled = true;
                    $("#cdExpl").val('');
                    cdExpl.disabled = true;
                    $("#rem").val('');
                    rem.disabled = true;
                    $("#optCd1").val('');
                    optCd1.disabled = true;
                    $("#optCd2").val('');
                    optCd2.disabled = true;
                    $("#optCd3").val('');
                    optCd3.disabled = true;
                    $("#optCd4").val('');
                    optCd4.disabled = true;
                    $("#sortNo").val('');
                    sortNo.disabled = true;
                    //팝업버튼
                    btnPopSearch.disabled = true;

                    
                    var list = grid.findRows({no:grid.getRowCount()});
                    if(list.length==0){
                      return;
                    }
                    var nRow = list[0].rowKey;
                    if(nRow==null){
                      return;
                    }
                    grid.focus(nRow, 'cdExplNm',false);
                    var contentHeight = $(".tui-grid-body-container").height();
                    $(".tui-grid-body-area").animate({
                      scrollTop : contentHeight
                    }, 500);

                    $('#rowKey').val(nRow);
                    fnGetDetailInfo(nRow);
                   
                }else{
                  if(rowKey == null || rowKey == ""){
                    gfnAlert("", "${msg.m00005}");
                      return false;
                  }
                  
                 
                  gfnConfirm("${msg.m00044}", function(confirm) { // 삭제 하시겠습니까?
                      if (confirm) {
                        grid.setValue(rowKey, 'useYn', 'N');
                        grid.setValue(rowKey, 'status', 'U');
                        var list2 = [];
                        var data = {"list" : "["+JSON.stringify(grid.getRow(rowKey))+"]", "list2" : JSON.stringify(list2)};
                        gfnAjax('/system/commonCode/saveAjax.do', data, fnAjaxHandler);
                      }
                  });  

              }
            break;
            

            case "open" :

            fnSelectListPop();
            break;

            case "tree" :
            

            for(var i=0;i<grid.getRows().length;i++){
              var prow = grid.getRow(i)._treeData.parentRowKey;
              //console.log();
              if(prow==null || prow==undefined){
                if($("#treeHeadPlus").html()=="-"){
                  grid.collapse(i,true);
                }else{
                  grid.expand(i,true);
                }
              }
            }
            if($("#treeHeadPlus").html()=="+"){
              $("#treeHeadPlus").html('-'); 
            }else{
              $("#treeHeadPlus").html('+');  
            }
            break;
        }
    }
    
    function getGridList(obj) {
        var list = [];
        var j=0;
        for(var i=0; i<obj.getRows().length; i++) {
            var rowKey = obj.getRowAt(i,false).rowKey;
            if(obj.getValue(rowKey, 'status') == 'U' || obj.getValue(rowKey, 'status') == 'I') {
              obj.setValue(rowKey,'_treeData',"");
                list[j++] = obj.getRow(rowKey);
            }
        }
        return list;
    }

    /////////////////////////////////////////////////////////
    //저장 데이타생성
    /////////////////////////////////////////////////////////
    function getGridList2(obj) {
        var list = [];
        var j=0;
        for(var i=0; i<obj.getRows().length; i++) {
          var rowKey = obj.getRowAt(i,false).rowKey;
          if(!gfnIsNull(obj.getValue(rowKey, 'grid2'))) {
                  var objGrid2 =   obj.getValue(rowKey, 'grid2');
                  for(var k=0; k < objGrid2.length; k++){
                        if(objGrid2[k].status =="U" || objGrid2[k].status =="I" ){
                            objGrid2[k].lgrpCd = obj.getValue(rowKey, 'lgrpCd');
                            objGrid2[k].sgrpCd = obj.getValue(rowKey, 'sgrpCd');
                            list[j++] = objGrid2[k]; 
                        }
                  }
          }
        }
        return list; 
    }


    /////////////////////////////////////////////////////////
    //조회버튼 ajax 성공 함수
    /////////////////////////////////////////////////////////
    function selectListCallback(data){
        var rows = data.rows;
        //console.log(rows);
        //트리펼치기
        for(var i=0; i<rows.length;i++){
          rows[i]._extraData = {treeState: 'EXPAND'}
        }
        grid.clear();
        grid.setData(data.rows);   
             		
        /*
        //그리드 no셋팅
        for(var i=0;i<grid.getRows().length;i++){
          var prow = grid.getRow(i)._treeData.parentRowKey;
          
          if(prow==null || prow==undefined){
           // grid.expand(i,true);
          }
          grid.setValue(i,'no',i+1);
        }
        */
        $("#totalNum").text(gfnFormatNumber(grid.getRows().length));
    }

    
    /////////////////////////////////////////////////////////
    //조회버튼 ajax 성공 함수
    /////////////////////////////////////////////////////////
    function selectListCallback2(data){
        var rows = data.rows;
        grid2.clear();
        grid2.setData(data.rows);  
    }


    /////////////////////////////////////////////////////////
    //저장 / 삭제시 ajax 후처리
    /////////////////////////////////////////////////////////
    function fnAjaxHandler(data){
       if(typeof data.resFlag != "undefined" && !data.resFlag){
            if(typeof data.resFlag != "undefined") {
                if(!data.resFlag){
                    if(( this.url.indexOf("save")>-1 || this.url.indexOf("update")>-1)) {
                      if(data.resMsg=="-100"){
                        gfnAlert("", "${msg.m00023}"); //중복된 데이터가 존재합니다. 다시 확인 바랍니다.
                      }else{
                        var msg = "${msg.m00003}";    //Failed to save!
                        if(data.errCode == "-11048") {
                            msg = msg + "${msg.m00046}"; //(최대 길이가 초과되었습니다. 데이터 길이를 확인해 주십시오.)
                        }
                        gfnAlert("ERROR", msg);
                      }
                    } else {
                      gfnAlert("", "${msg.m00004}");
                    }
                }
                return;
            }
            return;
        }else{
            if(( this.url.indexOf("save")>-1 || this.url.indexOf("update")>-1)) {
              gfnAlert("", "${msg.m00001}");
            } else {
              gfnAlert("", "${msg.m00002}");
            }
            
            fnSelectList();
        }
    }
  
  

/////////////////////////////////////////////////////////
//엑셀 다운로드 downloadExcelCallback
/////////////////////////////////////////////////////////
function downloadExcelCallback(data){
  window.location.href="<c:url value='/common/excel/excelDaownLoad.do?fileName=" + encodeURIComponent(data.fileName) + "&reasonCd=" + encodeURIComponent(data.reasonCd) + "&fileSize=" + encodeURIComponent(data.fileSize) + "'/>";
  $('#excelDownload').hide();
}


  /////////////////////////////////////////////////////////
  //엑셀 다운로드
  /////////////////////////////////////////////////////////
  function fnExcelDown(){

      if(grid.getRows().length == 0) {
          gfnAlert("", "${msg.m00028}"); //다운로드 받을 데이터가 없습니다. 다시 확인 바랍니다.
          return;
      }

      var data = {
              cdType : $('#schCdType').val(),
              dlrSrCd :$('#schDlrSrCd').val(),
              lgrpCd : $('#schLgrpCd').val(),
              cdExpl : $('#schCdExpl').val(),
              sgrpCd : $('#schSgrpCd').val(),
              cdExplNm : $('#schCdExplNm').val(),
              sUseYn:  $('#schUseYn').val(),
              reasonCd : $('#reasonCd').val()
            };      

      var url = "/system/commonCode/excelExport.do";
      gfnAjax(url, data, downloadExcelCallback);
  }


    /////////////////////////////////////////////////////////
  //Upload 파일 : 파일선택버튼클릭
  /////////////////////////////////////////////////////////
  function fnUpload(obj) {
      if (obj.files.length > 0) {
          if (obj.files && obj.files[0]) {
              var file = obj.value;
              var f = file.split(".");
              var fileExt = f[f.length-1].toLowerCase();
              
              if(f.length<=1) {
                  gfnAlert("", "${msg.m00039}", function() {
                      return;
                  });
                }
              
                if(fileExt != "xls" && fileExt != "xlsx") {
                  gfnAlert("", "${msg.m00039}", function() {
                      return;
                  });
                  return;
                }

                var url = '/system/commonCode/uploadAjax.do';
                var data = new FormData();

                var fileData = $("#btnUpload")[0];
                if (fileData.files.length > 0) {
                    data.append("upload", fileData.files[0]);
                }

               gfnAjax(url, data, callbackUpload, true);//formData 구별 위한 파라미터

          }
      }
  }
  /////////////////////////////////////////////////////////
  //Upload시 ajax 후처리
  /////////////////////////////////////////////////////////
  function callbackUpload(data) {

      if (typeof data.resFlag != "undefined" && !data.resFlag) {
          if (typeof data.resFlag != "undefined") {
              if (!data.resFlag) {
                  gfnAlert("", "${msg.m00038}");  //업로드에 실패하였습니다.
              }
              return;
          }
          return;

      } else {
          gfnAlert("INFORMATION", gfnGetMsg("${msg.m00037}", data.totCnt));
          //재조회
          grid.clear();
          grid2.clear();
          page=0;						   
        isMaxPage=false;				
          fnSelectList();
      }
  }

    </script>

</head>

<!-- body -->
<body>


  <!-- seaction -->
  <section class="container">
    <div class="content">
      <h3>title</h3>
      <div class="btn-area">
        <button class="line-button" id="excelUp"><i class="excelUp"></i>${msg.l00215}</button>
        <input id="btnUpload" name="btnUpload" type="file" accept=".xlsx" onchange="fnUpload(this);" hidden="true">
        <button class="line-button"   id="excelDownBtn"><i class="excelDown"></i>${msg.l00216}</button> <!--엑셀다운로드-->
        <button class="save-button" onclick="javascript:fnButtons('save');">${msg.l00213}</button> <!--저장-->
      </div>
    <!-- searchForm -->
      <div id="searchForm" class="search-form">
        <div class="search-input-area">
          <div class="col-4">
            <label for="schCdType"  style="width:50%;">${msg.l00128}</label><!--공통코드유형--> 
            <div class="inputWrap">
                <select name="schCdType" id="schCdType">
                  </select>
            </div>
          </div>
          <div class="col-4">
              <label for="schDlrSrCd"  style="width:50%;">${msg.l00233}</label>  <!--쇼룸/딜러-->
              <div class="inputWrap"> 
                  <select name="schDlrSrCd" id="schDlrSrCd">
                  </select>
                  
              </div>
            </div>

          <div class="col-4">
            <label for="schLgrpCd">${msg.l00023}</label>  <!--분류명리스트-->
            <div class="inputWrap"> 
                <select name="schLgrpCd" id="schLgrpCd">
                  <option value="">${msg.l00248}</option>
                </select>
            </div>
          </div>

            <div class="col-4">
              <label for="schCdExpl">${msg.l00023}</label> <!--분류명-->
              <div class="inputWrap">
                <input name="schCdExpl" id="schCdExpl" type="text" placeholder="" maxlength="100"  autocomplete="off">
              </div>
            </div>
          
            <div class="col-4">
              <label for="schSgrpCd"   style="width:50%;">${msg.l00237}</label> <!--소분류코드-->
              <div class="inputWrap">
                <input name="schSgrpCd" id="schSgrpCd" type="text" placeholder="" maxlength="10"  autocomplete="off">
              </div>
            </div>

            <div class="col-4">
              <label for="schCdExplNm"   style="width:50%;">${msg.l00238}</label> <!--소분류코드명-->
              <div class="inputWrap">
                <input name="schCdExplNm" id="schCdExplNm" type="text" placeholder="" maxlength="100"  autocomplete="off">
              </div>
            </div>
            
  
          <div class="col-4">
              <label for="schUseYn"   style="width:50%;">${msg.l00073}</label><!--사용유무-->
              <div class="inputWrap">
                  <select name="schUseYn" id="schUseYn" class="" placeholder="">
                    <option value="">selected</option>
                  </select>
              </div>
            </div>

          </div>

          <div class="search-button-area">
            <button class="search-button" onclick="javascript:fnSelectList();">${msg.l00207}</button>
          </div>
        </div>
        <!-- //searchForm -->
        <!-- row -->
        <div class="row">
          <!-- w-50 -->
          <div class="w-50">
            <h4>${msg.l00130}</h4> <!--분류명-->
            <button class="line-button btn-ico" onclick="javascript:fnButtons('delete');"><i class="ion ion-md-remove"></i></button>
            <button class="line-button btn-ico" onclick="javascript:fnButtons('new');"><i class="ion ion-md-add"></i></button>
            <div class="summary">${msg.l00214}<span id="totalNum">0</span></div>
            <div id="grid" class="grid3"></div>
          </div>
          <!-- //w-50 -->
          <div class="grid-line"></div>
          <!-- w-50 -->
          <div class="w-50 ">
            <h4>${msg.l00153}</h4> <!--코드상세정보-->
            <div class="btn-topWarp">
              
            </div>
            <!-- table-area -->
            <div class="table-area">
              <table class="list-table ">
                <colgroup>
                  <col style="width: 20%;">
                  <col style="width: 30%;">
                  <col style="width: 20%;">
                  <col style="width: 30%;">
                </colgroup>
                <tr>
                  <th><label for="className" class="must">${msg.l00235}</label></th> <!--분류명-->
                  <td><div class="search-input">
                    <input type="hidden" id="rowKey" name="rowKey" value="">
                    <input type="hidden" id="rowKey2" name="rowKey2" value="">
                    <input type="text" id="lgrpCd" name="lgrpCd" value=""  disabled><button id="btnPopSearch" name="btnPopSearch" class="btn-search" disabled onclick="javascript:fnButtons('open');"><i class="ion ion-ios-search"></i></button></div>
                  </td>
                  <th><label for="sgrpCd" class="must">${msg.l00237}</label></th> <!--공통코드-->
                  <td>
                    <input type="text" id="sgrpCd" name="sgrpCd" value=""  disabled  maxlength="10"  autocomplete="off">
                  </td>
                </tr>
                <tr>
                  <th><label for="cdExpl">${msg.l00238}</label></th> <!--공통코드명-->
                  <td colspan="3">
                    <textarea id="cdExpl" name="cdExpl" value="" disabled  maxlength="250"></textarea>
                  </td>
                </tr>
                <tr>
                  <th><label for="optCd1">${msg.l00133}(1)</label></th> <!--연계코드-->
                  <td><input type="text" id="optCd1" name="optCd1" value="" disabled  maxlength="250" autocomplete="off"></td>
                  <th><label for="optCd2">${msg.l00133}(2)</label></th>
                  <td><input type="text" id="optCd2" name="optCd2" value="" disabled  maxlength="250" autocomplete="off"></td>
                </tr>
                <tr>
                  <th><label for="optCd3">${msg.l00133}(3)</label></th> <!--연계코드-->
                  <td><input type="text" id="optCd3" name="optCd3" value="" disabled  maxlength="250" autocomplete="off"></td>
                  <th><label for="optCd4">${msg.l00133}(4)</label></th>
                  <td><input type="text" id="optCd4" name="optCd4" value="" disabled  maxlength="250" autocomplete="off"></td>
                </tr>
                <tr>
                  <th><label for="rem">${msg.l00072}</label></th> <!--비고-->
                  <td colspan="3">
                    <textarea id="rem" name="rem" value=""  disabled   maxlength="400"></textarea>
                  </td>
                </tr>
                <tr>
                  <th><label for="use">${msg.l00073}</label></th> <!--사용유무-->
                  <td>
                    <div class="check-area">
                      <div class="Checkbox_checkbox">
                        <label class="checkLabel">
                          <input class="Checkbox_input" type="checkbox" id="useYn" name="useYn" checked="">
                          <span class="checkmark"></span>
                        </label>
                      </div>
                    </div>
                  </td>
                  <th><label for="sortNo">${msg.l00090}</label></th> <!--정렬번호-->
                  <td><input type="text" id="sortNo" name="sortNo" value=""  autocomplete="off"  disabled></td>
                </tr>
              </table>
            </div>
            <!-- //table-area -->
  
            <!-- grid -->
            <h4>${msg.l00134}</h4> <!--코드 명 목록-->
            <div id="grid2" class="grid"></div>
            <!-- //grid -->
  
          </div>
          <!-- //w-50 -->
        </div>
        <!-- //row -->
      </div>
      <!-- //content -->
    </section>
    <!-- //seation -->
  

  <!-- 분류명 목록 modal -->
  <div id="commonCodeList" class="modal animate" style="display: none;">
    <!-- Modal content -->
    <div class="modal-content" id="modal-content">
      <div class="modal-header">
        <span class="close"><i class="ion ion-md-close"></i></span>
        <h5>${msg.l00206}</h5> <!--분류명 목록-->
      </div>
      <!-- modal-body -->
      <div class="modal-body">
        <!-- col-container -->
        <div class="col-container">
          <div id="searchForm" class="search-form">
            <div class="search-input-area">
             <!-- column -->
             <div class="column">
                <label for="schCode" style="width:50%;">${msg.l00235}</label>
                <div class="inputWrap">
                   <input name="schCode" id="schCode" type="text"  autocomplete="off">
                </div>
              </div>
              <!-- //column -->
               <!-- column -->
             <div class="column">
                <label for="schName" style="width:50%;">${msg.l00236}</label> 
                <div class="inputWrap">
                   <input name="schName" id="schName" type="text"  autocomplete="off">
                </div>
              </div>
              <!-- //column -->
            </div>

            <div class="search-button-area">
              <button class="search-button" onclick="javascript:fnSelectListPop();"><i class="ion ion-ios-search"></i>${msg.l00207}</button>
            </div>
          </div>

          <div class="row">
            <div id="grid3" class="grid3"></div>
          </div>

        </div>
        <!-- //col-container -->
        <div class="modal-btnWrap">
          <button type="submit" class="line-button" onclick="javascript:fnCancel();">${msg.l00136}</button>
          <button type="submit" class="line-button" onclick="javascript:fnReset();">${msg.l00137}</button>
          <button type="submit" class="save-button" onclick="javascript:fnSet();">${msg.l00138}</button>
        </div>
      </div>

      <!-- //modal-body -->
<script type="text/javascript">
    //그리드3 팝업용
    var rowHeaders3 = [
                    {
                        type: 'rowNum',
                        title: '${msg.l00011}'
                    }
                  ];

    var columns3 = [
                    {title: '${msg.l00235}',  name: 'code',align:'center'},
                    {title: '${msg.l00236}',  name: 'name'},
                  
                    {title:'', hidden:true, name: 'status'}
                  ];

    var option={gridid:"grid3", columns:columns3, rowHeaders:rowHeaders3,scrollX:false,scrollY:true,maxBodyHeight:350,minBodyHeight:300,bodyHeight:300}
    grid3 = createGridUi(option);


    function fnSelectListPop(){
       
      var url = "/system/commonCodeLgrp0000/selectListAjax.do";

      //그리드초기화
      grid3.clear();

      var data = {
        lgrpCd : $('#schCode').val(),
        cdExpl : $('#schName').val()
      };
      
      //조회
      gfnAjax(url, data, selectListCallback3);
    }

    /////////////////////////////////////////////////////////
    //조회버튼 ajax 성공 함수
    /////////////////////////////////////////////////////////
    function selectListCallback3(data){
        

      var rows = data.rows;
      grid3.clear();
      grid3.setData(data.rows);      
      setTimeout(function () {
        grid3.refreshLayout();  
        }, 100); 		
    }

    /////////////////////////////////////////////////////////
    //취소
    /////////////////////////////////////////////////////////
    function fnCancel(){
      $("#commonCodeList").hide();    		
    }

    /////////////////////////////////////////////////////////
    //초기화
    /////////////////////////////////////////////////////////
    function fnReset(dta){
      $("#lgrpCd").val('');
      $("#commonCodeList").hide();       		
    }

    /////////////////////////////////////////////////////////
    //적용
    /////////////////////////////////////////////////////////
    function fnSet(){
      var rowKey = grid3.getFocusedCell().rowKey;   

      if(rowKey==null){
        return;
      }  
      var row = grid3.getRow(rowKey);
      $("#lgrpCd").val(row.code); 
    
      var rowKey3 =  $("#rowKey").val(); 
      grid.setValue(rowKey3, 'lgrpCd', row.code);	
      grid.setValue(rowKey3, 'commonCode', row.code);	

      for(var i=0;i<grid2.getRows().length;i++){
           grid2.setValue(i,"lgrpCd",row.code);
      }

      $("#commonCodeList").hide();   	
    }
</script>
    </div>
    <!-- //Modal content -->

  </div>
  <!-- //modal -->

    </body>
  </html>